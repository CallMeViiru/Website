<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Viiru | Trades</title>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <header id="header">
        <img src="Images/Viiru.png" alt="Viiru Logo" id="HIcon" />
        <h1 id="HH1">Viiru</h1>
        <nav>
            <ul>
                <li><a href="https://www.viiru.top/" >Home</a></li>
                <li><a href="https://www.viiru.top/Store" >Store</a></li>
                <li><a href="https://www.viiru.top/Socials">Socials</a></li>
                <li><a href="https://www.viiru.top/about">About</a></li>
            </ul>
        </nav>
        <button id="darkModeToggle">ðŸŒ™</button>
    </header>

    <section class="login-section" id="login-section">
        <h2>Login to post trades</h2>
        <button id="google-login">Login with Google</button>
        <p>or</p>
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="Password">
        <button id="email-login">Login with Email</button>
    </section>

    <section class="trade-section" id="trade-section" style="display:none;">
        <h2>Post Your Trade</h2>
        <div class="multi-select">
            <div class="selectBox" id="giveSelect" onclick="toggleCheckboxes('giveBox')">Select items you give</div>
            <div class="checkboxes" id="giveBox"></div>
        </div>
        <input type="number" id="giveDiamonds" placeholder="Diamonds you give" min="0">

        <div class="multi-select">
            <div class="selectBox" id="wantSelect" onclick="toggleCheckboxes('wantBox')">Select items you want</div>
            <div class="checkboxes" id="wantBox"></div>
        </div>
        <input type="number" id="wantDiamonds" placeholder="Diamonds you want" min="0">

        <button id="post-trade">Post Trade</button>
    </section>

    <section class="trade-list-section">
        <h2>Active Trades</h2>
        <div id="trade-list"></div>
    </section>

    <footer id="footer">
        <p>Copyright &copy; viiru.top 2025</p>
        <a href="https://www.viiru.top/privacypolicy">Privacy Policy</a>
        <a href="https://www.viiru.top/tos">Terms of Service</a>
    </footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-analytics.js";
import { getFirestore, collection, addDoc, getDocs, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";

// Firebase config
const firebaseConfig = {
    apiKey: "AIzaSyBVJgqD79MXrKbU2okML4wzlMym7yaLxio",
    authDomain: "v11rutop.firebaseapp.com",
    projectId: "v11rutop",
    storageBucket: "v11rutop.firebasestorage.app",
    messagingSenderId: "664984661004",
    appId: "1:664984661004:web:357ea8a60723b000e55229",
    measurementId: "G-DMPEGNPVEN"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const db = getFirestore(app);
const auth = getAuth(app);

// Example items JSON
const items = ["Sword","Helmet","Shield","Bow","Arrow"];
const giveBox = document.getElementById("giveBox");
const wantBox = document.getElementById("wantBox");
const tradeList = document.getElementById("trade-list");

// Populate checkboxes
function populateItems(box){
    items.forEach(item => {
        const label = document.createElement("label");
        const input = document.createElement("input");
        input.type = "checkbox";
        input.value = item;
        label.appendChild(input);
        label.append(item);
        box.appendChild(label);
    });
}
populateItems(giveBox);
populateItems(wantBox);

// Multi-select dropdown logic
function toggleCheckboxes(boxId){
    const box = document.getElementById(boxId);
    box.style.display = box.style.display==="block"?"none":"block";
}

function updateSelectBox(boxId, selectBoxId){
    const checked = Array.from(document.querySelectorAll(`#${boxId} input:checked`)).map(i=>i.value);
    const selectBox = document.getElementById(selectBoxId);
    selectBox.textContent = checked.length>0 ? checked.join(", ") : (selectBoxId==="giveSelect"?"Select items you give":"Select items you want");
}
["giveBox","wantBox"].forEach(boxId=>{
    document.getElementById(boxId).addEventListener("change", e=>{
        updateSelectBox(boxId, boxId==="giveBox"?"giveSelect":"wantSelect");
    });
});

// Login system
document.getElementById("google-login").addEventListener("click", async ()=>{
    const provider = new GoogleAuthProvider();
    await signInWithPopup(auth, provider);
});

document.getElementById("email-login").addEventListener("click", async ()=>{
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    await signInWithEmailAndPassword(auth,email,password);
});

// Show logged in state and trade form
onAuthStateChanged(auth, user=>{
    if(user){
        document.getElementById("login-section").style.display="none";
        document.getElementById("trade-section").style.display="block";
    } else {
        document.getElementById("login-section").style.display="block";
        document.getElementById("trade-section").style.display="none";
    }
});

// Post a trade
document.getElementById("post-trade").addEventListener("click", async ()=>{
    const giveItems = Array.from(document.querySelectorAll("#giveBox input:checked")).map(i=>i.value);
    const wantItems = Array.from(document.querySelectorAll("#wantBox input:checked")).map(i=>i.value);
    const giveDiamonds = parseInt(document.getElementById("giveDiamonds").value)||0;
    const wantDiamonds = parseInt(document.getElementById("wantDiamonds").value)||0;

    if(!auth.currentUser){
        alert("Please log in to post a trade.");
        return;
    }

    await addDoc(collection(db,"trades"),{
        uid: auth.currentUser.uid,
        username: auth.currentUser.displayName||auth.currentUser.email,
        giveItems,
        wantItems,
        giveDiamonds,
        wantDiamonds,
        timestamp: serverTimestamp()
    });
    alert("Trade posted!");
    loadTrades();
});

// Load trades
async function loadTrades(){
    tradeList.innerHTML="";
    const q = query(collection(db,"trades"), orderBy("timestamp","desc"));
    const snapshot = await getDocs(q);
    snapshot.forEach(doc=>{
        const data = doc.data();
        const div = document.createElement("div");
        div.className="product-box";
        div.innerHTML=`<h3>${data.username}</h3>
                       <p>Gives: ${data.giveItems.join(", ")} + ${data.giveDiamonds} diamonds</p>
                       <p>Wants: ${data.wantItems.join(", ")} + ${data.wantDiamonds} diamonds</p>`;
        tradeList.appendChild(div);
    });
}
loadTrades();
</script>
</body>
</html>


